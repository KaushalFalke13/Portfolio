<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Simplified Sticky Center Box</title>
<style>
  :root { --box-w:420px; --box-h:320px; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#111;color:#eee}

  section {
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:2rem;
  }

  .intro { background:#222; }
  .outro { background:#333; }

  .projects-wrapper {
    position: relative; 
  }

  .project {
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .project:nth-of-type(1){ background:#84a8e4; color:#fff }
  .project:nth-of-type(2){ background:#f7f7f7; color:#111 }
  .project:nth-of-type(3){ background:#101820; color:#fff }
  .project:nth-of-type(4){ background:#f1f1f1; color:#111 }

  .center-box {
    position: fixed;
     top: 50%;
   /* right: 36%; */
    transform: translateY(-50%);
    margin: 0 auto;
    width: var(--box-w);
    height: var(--box-h);
    border-radius: 10px;
    box-shadow: 0 18px 40px rgba(0,0,0,.6);
    z-index: 10;
  }

  .center-box img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    clip-path: inset(0 0 0 0);
  }
  .topImg { z-index: 2; }
  .bottomImg { z-index: 1; }

  @media (max-width:700px){
    :root{ --box-w:320px; --box-h:220px; }
  }
</style>
</head>
<body>

<!-- <section class="intro">Intro Section</section> -->

<div class="projects-wrapper">
  <div class="center-box">
    <img id="topImage" class="topImg" src="https://picsum.photos/id/1018/1200/900">
    <img id="bottomImage" class="bottomImg" src="https://picsum.photos/id/1018/1200/900">
  </div>

  <section class="project" data-image="https://picsum.photos/id/1018/1200/900">Project 1</section>
  <section class="project" data-image="https://picsum.photos/id/1025/1200/900">Project 2</section>
  <section class="project" data-image="https://picsum.photos/id/1039/1200/900">Project 3</section>
  <section class="project" data-image="https://picsum.photos/id/1045/1200/900">Project 4</section>
</div>

<section class="outro">Outro Section</section>

<script>
const projects = document.querySelectorAll(".project");
const topImage = document.getElementById("topImage");
const bottomImage = document.getElementById("bottomImage");

function updateSplit(){
  const box = document.querySelector(".center-box");
  const boxRect = box.getBoundingClientRect();
  const boxTop = boxRect.top;
  const boxBottom = boxRect.bottom;
  const boxHeight = boxRect.height;

  let found = false;
  for(let i=0;i<projects.length-1;i++){
    const next = projects[i+1];
    const boundaryY = next.getBoundingClientRect().top;
    if(boundaryY >= boxTop && boundaryY <= boxBottom){
      found = true;
      topImage.src = projects[i].dataset.image;
      bottomImage.src = projects[i+1].dataset.image;
      let rel = (boundaryY - boxTop)/boxHeight;
      rel = Math.max(0,Math.min(1,rel));
      const cut = rel*100;
      topImage.style.clipPath = `inset(0 0 ${100-cut}% 0)`;
      bottomImage.style.clipPath = `inset(${cut}% 0 0 0)`;
      break;
    }
  }
  if(!found){
    const centerY = window.innerHeight/2;
    const current = [...projects].find(s=>{
      const r = s.getBoundingClientRect();
      return r.top <= centerY && r.bottom >= centerY;
    }) || projects[projects.length-1];
    topImage.src=current.dataset.image;
    bottomImage.src=current.dataset.image;
    topImage.style.clipPath='inset(0 0 0 0)';
    bottomImage.style.clipPath='inset(100% 0 0 0)';
  }
}

window.addEventListener("scroll", updateSplit, {passive:true});
window.addEventListener("resize", updateSplit);
updateSplit();
</script>

</body>
</html>
